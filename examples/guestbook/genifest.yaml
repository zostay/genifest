metadata:
  cloudHome: .
  scripts: [scripts]
  manifests: [manifests]
  files: [files]

functions:
  - name: get-replicas
    params:
      - name: environment
        required: true
    valueFrom:
      default:
        value: "2"

  - name: get-image-tag
    params:
      - name: service
        required: true
      - name: environment
        required: true
    valueFrom:
      template:
        string: "${service}:${environment}-latest"
        variables:
          - name: service
            valueFrom:
              argRef:
                name: service
          - name: environment
            valueFrom:
              argRef:
                name: environment

  - name: get-database-host
    params:
      - name: environment
        required: true
    valueFrom:
      default:
        value: postgres-service

  - name: quote
    params:
      - name: text
        required: true
    valueFrom:
      script:
        exec: quotes.sh
        args:
          - name: text
            valueFrom:
              argRef:
                name: text
  - name: rotN
    params:
      - name: text
        required: true
    valueFrom:
      script:
        exec: rotNN.sh
        stdin:
          argRef:
            name: text
        args:
          - name: N
            valueFrom:
              documentRef:
                keySelector: .metadata.annotations["genifest.qubling.com/rotN"]